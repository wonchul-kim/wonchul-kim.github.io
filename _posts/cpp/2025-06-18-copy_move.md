---
layout: post
title: Copy & Move
category: C++
tag: [copy, move]
---

### Copy

객체의 내용을 복제해서 새로운 객체를 만드는 것으로 원본과 복사본이 서로 다른 리소스를 가진다. 

* 복사 생성자
    ```cpp
    MyClass(const MyClass& other);  // 복사 생성자
    ```

* 복사 예시
    ```cpp
    std::string a = "Hello";
    std::string b = a; // 복사 발생

    // a, b는 서로 독립적인 메모리 영역을 가진 "Hello"
    ```

### Move 

객체의 내부 자원(메모리, 포인터 등)을 소유권 이전해서 새 객체로 넘기는 것으로, 복사하지 않고 기존 리소스를 *훔쳐온다*는 개념

* 이동 생성자
    ```cpp
    MyClass(MyClass&& other);  // 이동 생성자
    ```

* 이동 예시
    ```cpp
    std::string a = "World";
    std::string b = std::move(a);  // 이동 발생

    // a는 비워지고, b가 "World"를 가짐 (메모리 복사 없음)
    ```

#### 요약

| 항목      | 복사(Copy)       | 이동(Move)                      |
| ------- | -------------- | ----------------------------- |
| 의미      | 값의 복제          | 자원의 이전                        |
| 비용      | **높음** (깊은 복사) | **낮음** (얕은 복사)                |
| 원본 상태   | 그대로 유지         | “비워짐” (valid but unspecified) |
| 함수 시그니처 | `T(const T&)`  | `T(T&&)`                      |
| 사용 조건   | 항상 가능          | Rvalue일 때만 가능 (`std::move`)   |
| 사용 예    | 객체 저장, 값 복사    | 리소스 이전, 성능 최적화                |


#### 선택

| 상황              | 복사? 이동?                     |
| --------------- | --------------------------- |
| 값을 공유하지 않아도 될 때 | **복사**                      |
| 리소스가 크거나 깊을 때   | **이동 (prefer)**             |
| 함수 인자로 받을 때     | `T&&`로 받고 `std::move()`     |
| 반환값 최적화         | C++11부터는 반환 시 **자동 이동**이 가능 |

#### 함수 인자 전달 형태 요약

| 형태     | 시그니처                   | 효과                  |
| ------ | ---------------------- | ------------------- |
| 값 전달   | `void foo(T t)`        | 복사 또는 이동            |
| 참조 전달  | `void foo(T& t)`       | 복사/이동 없음 (원본 수정 가능) |
| 상수 참조  | `void foo(const T& t)` | 읽기 전용 참조 (복사 없음)    |
| 우측값 참조 | `void foo(T&& t)`      | 이동 허용 (성능 최적화)      |
