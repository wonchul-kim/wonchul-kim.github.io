---
layout: post
title: Pybind
category: Python
tag: pybind
---

#### Install

```sh
pip install pybind11
```

#### Example

1. `example.cpp` 

```cpp
// example.cpp

#include <pybind11/pybind11.h>

namespace py = pybind11;

int add(int i, int j) {
    return i + j;
}

// 모듈 이름은 'example'입니다.
PYBIND11_MODULE(example, m) {
    m.doc() = "Pybind11 example module"; // 모듈 설명

    // 'add' 함수를 파이썬에 노출
    m.def("add", &add, "A function that adds two numbers");
}
```

2. Build

```sh
mkdir build
cd build
cmake .. -Dpybind11_DIR=/usr/local/lib/python3.10/dist-packages/pybind11/share/cmake/pybind11/

cmake --build . --config Release # 확장 모듈(.so)을 생성
```


이 때, 아래와 같은 이슈가 발생한다면, 
```sh
CMake Error at CMakeLists.txt:11 (find_package):
  By not providing "Findpybind11.cmake" in CMAKE_MODULE_PATH this project has
  asked CMake to find a package configuration file provided by "pybind11",
  but CMake did not find one.

  Could not find a package configuration file provided by "pybind11" with any
  of the following names:

    pybind11Config.cmake
    pybind11-config.cmake

  Add the installation prefix of "pybind11" to CMAKE_PREFIX_PATH or set
  "pybind11_DIR" to a directory containing one of the above files.  If
  "pybind11" provides a separate development package or SDK, be sure it has
  been installed
```

`Dpybind11_DIR`를 명시하여 SDK를 사용할 수 있도록 한다.

경로는 아래와 같이 찾을 수 있다. 

```sh
pybind11-config --cmakedir
```

3. Import 

* `test.py`

```python
import sys
import os

# .so 파일이 있는 디렉토리 경로 (빌드 디렉토리)
# 현재 스크립트를 프로젝트 루트에서 실행한다고 가정하고 'build' 디렉토리를 추가
build_dir = os.path.join(os.path.dirname(__file__), 'build') 

# 이 경로를 sys.path에 추가
sys.path.append(build_dir) 

# 이제 모듈 이름을 사용하여 import (확장자 제외)
# 파일 이름이 example.cpython-310-x86_64-linux-gnu.so 이므로 모듈 이름은 'example'
try:
    import example
    result = example.add(5, 7)
    print(f"C++ 함수 호출 성공: {result}")
    
except ImportError as e:
    print(f"Import Error: {e}")
    print(f"sys.path에 {build_dir} 경로가 제대로 추가되었는지 확인하세요.")
```